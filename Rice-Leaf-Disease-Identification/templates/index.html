<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√°t hi·ªán b·ªánh l√° l√∫a</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>üåæ Ph√°t hi·ªán b·ªánh l√° l√∫a</h1>
            <p>S·ª≠ d·ª•ng AI ƒë·ªÉ nh·∫≠n di·ªán c√°c lo·∫°i b·ªánh tr√™n l√° l√∫a</p>
        </header>

        <main>
            <div class="upload-section">
                <form id="uploadForm" action="/predict" method="post" enctype="multipart/form-data">
                    <div class="model-selection">
                        <label for="model_type">Ch·ªçn m√¥ h√¨nh:</label>
                        <select name="model_type" id="model_type">
                            <option value="resnet" {% if selected_model=='resnet' or
                                request.form.get('model_type')=='resnet' %}selected{% endif %}>
                                ResNet152V2 (ƒê·ªô ch√≠nh x√°c cao)</option>
                            <option value="mobilenet" {% if selected_model=='mobilenet' or
                                request.form.get('model_type')=='mobilenet' %}selected{% endif %}>
                                MobileNetV2 (Nhanh, nh·∫π)</option>
                        </select>
                    </div>

                    <div class="quality-options">
                        <label class="checkbox-label">
                            <input type="checkbox" name="disable_quality_check" id="disableQualityCheck">
                            <span class="checkmark"></span>
                            T·∫Øt ki·ªÉm tra ch·∫•t l∆∞·ª£ng ·∫£nh (cho ph√©p ph√¢n t√≠ch m·ªçi ·∫£nh)
                        </label>
                    </div>

                    <div class="file-upload">
                        <input type="file" id="fileInput" name="file" accept="image/*" required>
                        <label for="fileInput" class="file-label">
                            <span class="file-icon">üìÅ</span>
                            <span class="file-text">Ch·ªçn ·∫£nh l√° l√∫a</span>
                        </label>

                        <!-- Preview container -->
                        <div id="imagePreview" class="image-preview-container" style="display: none;">
                            <div class="preview-header">
                                <h4>üì∏ ·∫¢nh ƒë√£ ch·ªçn:</h4>
                                <button type="button" id="removeImage" class="remove-btn">‚úï</button>
                            </div>
                            <div class="preview-content">
                                <img id="previewImg" src="" alt="Preview" class="preview-image">
                                <div class="preview-info">
                                    <div id="fileName" class="file-name"></div>
                                    <div id="fileSize" class="file-size"></div>
                                    <div id="fileDimensions" class="file-dimensions"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="predict-btn">üîç Ph√¢n t√≠ch</button>
                        <button type="button" id="resetButton" class="reset-btn">üîÑ ƒê·∫∑t l·∫°i</button>
                    </div>
                </form>
            </div>

            {% if error %}
            <div class="error-message">
                <h3>‚ùå L·ªói</h3>
                <p>{{ error }}</p>
                {% if show_skip_option %}
                <div class="skip-option">
                    <form action="/predict" method="post" enctype="multipart/form-data" style="display: inline;">
                        <input type="hidden" name="model_type" value="{{ request.form.get('model_type', 'resnet') }}">
                        <input type="hidden" name="skip_quality_check" value="true">
                        <input type="hidden" name="file"
                            value="{{ request.files.get('file', '').filename if request.files.get('file') else '' }}">
                        <button type="submit" class="skip-btn">‚ö†Ô∏è B·ªè qua ki·ªÉm tra ch·∫•t l∆∞·ª£ng v√† ph√¢n t√≠ch</button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if result %}
            <div class="result-section">
                <h2>üìä K·∫øt qu·∫£ ph√¢n t√≠ch</h2>

                {% if uploaded_image %}
                <div class="image-preview">
                    <h3>·∫¢nh ƒë√£ t·∫£i l√™n:</h3>
                    <img src="{{ uploaded_image }}" alt="Uploaded image" class="uploaded-img">
                </div>
                {% endif %}

                <div class="prediction-result">
                    <div class="result-card">
                        <h3>üéØ D·ª± ƒëo√°n</h3>
                        <div class="disease-name">{{ result.class }}</div>
                        <div class="model-info">
                            <span class="model-used">M√¥ h√¨nh: {{ result.model_used }}</span>
                            <span class="confidence">ƒê·ªô tin c·∫≠y: {{ "%.1f"|format(result.confidence * 100) }}%</span>
                        </div>
                    </div>
                </div>

                {% if result.quality_info %}
                <div class="quality-info">
                    <h3>üìä Ch·∫•t l∆∞·ª£ng ·∫£nh</h3>
                    <div class="quality-score">
                        <div class="score-circle">
                            <span class="score-number">{{ result.quality_info.score }}</span>
                            <span class="score-total">/100</span>
                        </div>
                        <div class="score-grade">Grade: {{ result.quality_info.grade }}</div>
                    </div>

                    {% if result.quality_warnings %}
                    <div class="quality-warnings">
                        <h4>‚ö†Ô∏è C·∫£nh b√°o ch·∫•t l∆∞·ª£ng:</h4>
                        <ul>
                            {% for warning in result.quality_warnings %}
                            <li>{{ warning }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <div class="disease-info">
                    <h3>‚ÑπÔ∏è Th√¥ng tin v·ªÅ b·ªánh</h3>
                    <div class="info-content">
                        {% if result.class == 'Healthy' %}
                        <p><strong>L√° l√∫a kh·ªèe m·∫°nh:</strong> Kh√¥ng c√≥ d·∫•u hi·ªáu b·ªánh t·∫≠t, c√¢y ph√°t tri·ªÉn b√¨nh th∆∞·ªùng.
                        </p>
                        {% elif result.class == 'Bacterial Leaf Blast' %}
                        <p><strong>B·ªánh ch√°y l√° do vi khu·∫©n:</strong> G√¢y ra b·ªüi vi khu·∫©n Xanthomonas oryzae, l√†m l√° b·ªã
                            ch√°y v√† h√©o.</p>
                        {% elif result.class == 'Brown Spot' %}
                        <p><strong>B·ªánh ƒë·ªëm n√¢u:</strong> G√¢y ra b·ªüi n·∫•m Helminthosporium oryzae, t·∫°o ra c√°c ƒë·ªëm n√¢u
                            tr√™n l√°.</p>
                        {% elif result.class == 'Leaf Blast' %}
                        <p><strong>B·ªánh ch√°y l√°:</strong> G√¢y ra b·ªüi n·∫•m Magnaporthe oryzae, l√†m l√° b·ªã ch√°y v√† r·ª•ng s·ªõm.
                        </p>
                        {% elif result.class == 'Leaf Scald' %}
                        <p><strong>B·ªánh ch√°y l√° do n·∫Øng:</strong> G√¢y ra b·ªüi n·∫•m Rhynchosporium oryzae, l√†m l√° b·ªã ch√°y
                            v√† kh√¥.</p>
                        {% elif result.class == 'Narrow Brown Spot' %}
                        <p><strong>B·ªánh ƒë·ªëm n√¢u h·∫πp:</strong> G√¢y ra b·ªüi n·∫•m Cercospora oryzae, t·∫°o ra c√°c ƒë·ªëm n√¢u h·∫πp
                            tr√™n l√°.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="info-section">
                <h2>üìã H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>üì∏ Ch·ª•p ·∫£nh</h3>
                        <p>Ch·ª•p ·∫£nh l√° l√∫a r√µ n√©t, ƒë·ªß √°nh s√°ng, t·∫≠p trung v√†o v√πng b·ªã b·ªánh</p>
                    </div>
                    <div class="info-card">
                        <h3>üîç Ph√¢n t√≠ch</h3>
                        <p>Ch·ªçn m√¥ h√¨nh ph√π h·ª£p v√† nh·∫•n "Ph√¢n t√≠ch" ƒë·ªÉ nh·∫≠n k·∫øt qu·∫£</p>
                    </div>
                    <div class="info-card">
                        <h3>üìä K·∫øt qu·∫£</h3>
                        <p>Xem k·∫øt qu·∫£ d·ª± ƒëo√°n, ƒë·ªô tin c·∫≠y v√† th√¥ng tin v·ªÅ b·ªánh</p>
                    </div>
                </div>
            </div>

            <div class="model-comparison">
                <h2>‚öñÔ∏è So s√°nh m√¥ h√¨nh</h2>
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>T√≠nh nƒÉng</th>
                                <th>ResNet152V2</th>
                                <th>MobileNetV2</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>ƒê·ªô ch√≠nh x√°c</strong></td>
                                <td>Cao</td>
                                <td>T·ªët</td>
                            </tr>
                            <tr>
                                <td><strong>T·ªëc ƒë·ªô</strong></td>
                                <td>Ch·∫≠m h∆°n</td>
                                <td>Nhanh h∆°n</td>
                            </tr>
                            <tr>
                                <td><strong>K√≠ch th∆∞·ªõc</strong></td>
                                <td>L·ªõn (~600MB)</td>
                                <td>Nh·ªè (~14MB)</td>
                            </tr>
                            <tr>
                                <td><strong>Ph√π h·ª£p cho</strong></td>
                                <td>ƒê·ªô ch√≠nh x√°c cao</td>
                                <td>Thi·∫øt b·ªã di ƒë·ªông</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <footer>
            <p>üåæ Rice Leaf Disease Identification - Powered by AI</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='reset.js') }}"></script>
    <script src="{{ url_for('static', filename='image-preview.js') }}"></script>
</body>

</html>